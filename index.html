<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Motor Data Logger</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 40px;
      background-color: #f9f9f9;
    }
    h1, h2 {
      color: #333;
    }
    .section {
      margin-bottom: 40px;
    }
    label {
      display: block;
      margin-top: 10px;
    }
    input, select, button, textarea {
      margin-top: 5px;
      padding: 5px;
      width: 100%;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }
    th, td {
      border: 1px solid #aaa;
      padding: 8px;
      text-align: left;
    }
    th {
      background-color: #ddd;
    }
  </style>
</head>
<body>
  <h1>Motor Data Logger</h1>

  <div class="section">
    <label for="actionSelect">Choose Action</label>
    <select id="actionSelect" onchange="handleAction(this.value)">
      <option value="">--Select--</option>
      <option value="add">Add Motor</option>
      <option value="edit">Edit Motor</option>
      <option value="viewOne">View Particular Motor</option>
      <option value="viewAll">View All Motors</option>
    </select>
  </div>

  <div class="section" id="passwordSection" style="display:none;">
    <label for="passwordInput">Enter Password</label>
    <input type="password" id="passwordInput" />
    <button onclick="checkPassword()">Submit</button>
  </div>

  <form id="addForm" class="section" style="display:none;">
    <h2>Add Motor</h2>
    <label for="date">Date</label><input type="date" id="date" required />
    <label for="tag">Motor Tag</label><input type="text" id="tag" required />
    <label for="flc">FLC (A)</label><input type="number" id="flc" required />
    <label for="nlc">NLC (A)</label><input type="number" id="nlc" required />
    <label for="voltage">Rated Voltage</label><input type="text" id="voltage" required />
    <label for="rpm">RPM</label><input type="number" id="rpm" required />
    <label for="rotation">Rotation</label><input type="text" id="rotation" required />
    <label for="temp_de_start">Temp DE (Start)</label><input type="text" id="temp_de_start" />
    <label for="temp_de_end">Temp DE (End)</label><input type="text" id="temp_de_end" />
    <label for="winding_start">Temp Winding (Start)</label><input type="text" id="winding_start" />
    <label for="winding_end">Temp Winding (End)</label><input type="text" id="winding_end" />
    <label for="temp_nde_start">Temp NDE (Start)</label><input type="text" id="temp_nde_start" />
    <label for="temp_nde_end">Temp NDE (End)</label><input type="text" id="temp_nde_end" />
    <label for="sound">Abnormal Sound</label><input type="text" id="sound" />
    <label for="remarks">Remarks</label><textarea id="remarks"></textarea>
    <button type="submit">Add Motor</button>
  </form>

  <form id="editForm" class="section" style="display:none;">
    <h2>Edit Motor</h2>
    <label for="editSelect">Select Motor Tag</label>
    <select id="editSelect"></select>
    <label for="edit_date">Date</label><input type="date" id="edit_date" required />
    <label for="edit_tag">Motor Tag</label><input type="text" id="edit_tag" required />
    <label for="edit_flc">FLC (A)</label><input type="number" id="edit_flc" required />
    <label for="edit_nlc">NLC (A)</label><input type="number" id="edit_nlc" required />
    <label for="edit_voltage">Rated Voltage</label><input type="text" id="edit_voltage" required />
    <label for="edit_rpm">RPM</label><input type="number" id="edit_rpm" required />
    <label for="edit_rotation">Rotation</label><input type="text" id="edit_rotation" required />
    <label for="edit_temp_de_start">Temp DE (Start)</label><input type="text" id="edit_temp_de_start" />
    <label for="edit_temp_de_end">Temp DE (End)</label><input type="text" id="edit_temp_de_end" />
    <label for="edit_winding_start">Temp Winding (Start)</label><input type="text" id="edit_winding_start" />
    <label for="edit_winding_end">Temp Winding (End)</label><input type="text" id="edit_winding_end" />
    <label for="edit_temp_nde_start">Temp NDE (Start)</label><input type="text" id="edit_temp_nde_start" />
    <label for="edit_temp_nde_end">Temp NDE (End)</label><input type="text" id="edit_temp_nde_end" />
    <label for="edit_sound">Abnormal Sound</label><input type="text" id="edit_sound" />
    <label for="edit_remarks">Remarks</label><textarea id="edit_remarks"></textarea>
    <button type="submit">Update Motor</button>
  </form>

  <div id="filterSection" class="section" style="display:none;">
    <h2>Search Motor by Tag</h2>
    <input type="text" id="filterInput" placeholder="Enter tag..." oninput="filterMotor()" />
    <div id="filteredResult"></div>
  </div>

  <div id="motorLogSection" class="section" style="display:none;">
    <h2>All Motors</h2>
    <button onclick="downloadPDF()">Download PDF</button>
    <table id="motorTable">
      <thead>
        <tr>
          <th>Date</th><th>Tag</th><th>FLC</th><th>NLC</th><th>Voltage</th><th>RPM</th><th>Rotation</th>
          <th>Temp DE Start</th><th>Temp DE End</th><th>Winding Start</th><th>Winding End</th>
          <th>NDE Start</th><th>NDE End</th><th>Sound</th><th>Remarks</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <script>
    const fields = [
      "date", "tag", "flc", "nlc", "voltage", "rpm", "rotation",
      "temp_de_start", "temp_de_end",
      "winding_start", "winding_end",
      "temp_nde_start", "temp_nde_end",
      "sound", "remarks"
    ];

    const addForm = document.getElementById("addForm");
    const editForm = document.getElementById("editForm");
    const filterInput = document.getElementById("filterInput");

    addForm.onsubmit = function (e) {
      e.preventDefault();
      const motors = JSON.parse(localStorage.getItem("motors")) || [];
      const newMotor = {};
      fields.forEach(field => {
        newMotor[field] = document.getElementById(field).value;
      });
      if (motors.find(m => m.tag === newMotor.tag)) {
        alert("Motor tag already exists!");
        return;
      }
      motors.push(newMotor);
      localStorage.setItem("motors", JSON.stringify(motors));
      alert("Motor added successfully!");
      addForm.reset();
    };

    editForm.onsubmit = function (e) {
      e.preventDefault();
      const motors = JSON.parse(localStorage.getItem("motors")) || [];
      const originalTag = document.getElementById("editSelect").value;
      const index = motors.findIndex(m => m.tag === originalTag);
      if (index < 0) return alert("Motor not found.");

      const updatedMotor = {};
      fields.forEach(field => {
        updatedMotor[field] = document.getElementById("edit_" + field).value;
      });

      motors[index] = updatedMotor;
      localStorage.setItem("motors", JSON.stringify(motors));
      alert("Motor updated successfully!");
      updateEditDropdown();
    };

    function updateEditDropdown() {
      const motors = JSON.parse(localStorage.getItem("motors")) || [];
      const select = document.getElementById("editSelect");
      select.innerHTML = "";
      motors.forEach(m => {
        const opt = document.createElement("option");
        opt.value = m.tag;
        opt.textContent = m.tag;
        select.appendChild(opt);
      });
      select.onchange = () => {
        const motor = motors.find(m => m.tag === select.value);
        if (motor) {
          fields.forEach(f => {
            document.getElementById("edit_" + f).value = motor[f] || "";
          });
        }
      };
      if (motors.length) {
        select.dispatchEvent(new Event("change"));
      }
    }

    function handleAction(action) {
      addForm.style.display = "none";
      editForm.style.display = "none";
      document.getElementById("passwordSection").style.display = "none";
      document.getElementById("filterSection").style.display = "none";
      document.getElementById("motorLogSection").style.display = "none";

      if (action === "add" || action === "edit") {
        document.getElementById("passwordSection").style.display = "block";
      } else if (action === "viewOne") {
        document.getElementById("filterSection").style.display = "block";
        filterInput.value = "";
        document.getElementById("filteredResult").innerHTML = "";
      } else if (action === "viewAll") {
        document.getElementById("motorLogSection").style.display = "block";
        loadMotors();
      }
    }

    function checkPassword() {
      const action = document.getElementById("actionSelect").value;
      const pass = document.getElementById("passwordInput").value;
      if (pass === "area123") {
        if (action === "add") {
          addForm.style.display = "block";
        } else if (action === "edit") {
          editForm.style.display = "block";
          updateEditDropdown();
        }
        document.getElementById("passwordSection").style.display = "none";
      } else {
        alert("Incorrect password!");
      }
    }

    function loadMotors() {
      const motors = JSON.parse(localStorage.getItem("motors")) || [];
      const tbody = document.querySelector("#motorTable tbody");
      tbody.innerHTML = "";
      motors.forEach(m => {
        const tr = document.createElement("tr");
        fields.forEach(f => {
          const td = document.createElement("td");
          td.textContent = m[f] || "";
          tr.appendChild(td);
        });
        tbody.appendChild(tr);
      });
    }

    function filterMotor() {
      const motors = JSON.parse(localStorage.getItem("motors")) || [];
      const val = filterInput.value.toLowerCase();
      const result = motors.find(m => m.tag.toLowerCase() === val);
      const container = document.getElementById("filteredResult");
      container.innerHTML = result
        ? `<pre>${JSON.stringify(result, null, 2)}</pre>`
        : "No motor found.";
    }

    function downloadPDF() {
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();
      doc.text("Motor Log Report", 14, 15);

      const headers = [[
        "Date", "Tag", "FLC", "NLC", "Voltage", "RPM", "Rotation",
        "Temp DE Start", "Temp DE End", "Winding Start", "Winding End",
        "NDE Start", "NDE End", "Sound", "Remarks"
      ]];

      const motors = JSON.parse(localStorage.getItem("motors")) || [];
      const rows = motors.map(m => fields.map(f => m[f] || ""));

      doc.autoTable({
        head: headers,
        body: rows,
        startY: 20,
        styles: { fontSize: 8 },
        headStyles: { fillColor: [60, 141, 188] }
      });

      doc.save("motor_log.pdf");
    }
  </script>
</body>
</html>
